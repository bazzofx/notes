[[How to File Upload]]
Some websites upload the file directly to the main filesystem and then remove it again if it doesn't pass validation. This kind of behavior is typical in websites that rely on anti-virus software and the like to check for malware. This may only take a few milliseconds, but for the short time that the file exists on the server, the attacker can potentially still execute it.

These vulnerabilities are often extremely subtle, making them difficult to detect during blackbox testing unless you can find a way to leak the relevant source code.


### Upload Race Conditions
![[Pasted image 20251209004504.png]]
We submit a POST and a GET request in parallel.
Some servers the file will exist for a few seconds before its deleted, if we run a GET request before the file is deleted we can get a race condition on the server.
On the example above we submitted a POST request containing our .php file and we had run a GET request to the file path. Both requests were sent in parallel.
Although some requests failed, a few of them succeeded.
> Obs: It's normal to have many fail attempts before getting one succesful

#### Turbo Intruder Plugin - Race Conditions
We can also use a Burp Suite plugin called Turbo Intruder to run specific request very fast, attempting to trigger a race condition on the server.
On this scenario, we can imagine the Anti-Virus is destroyin the file before we can get to it, so we will send requests consecutives at a very fast pace so we can try catch the file

We will use 1 POST request and send many GET requests to the file
1. Right click on the Post Request > Extension > Turbo Intruder

2. Copy and pate the below script
```bash
def queueRequests(target, wordlists):
    engine = RequestEngine(endpoint=target.endpoint, concurrentConnections=20,)

    request1 = '''<YOUR-POST-REQUEST>'''

    request2 = '''<YOUR-GET-REQUEST>'''

    # the 'gate' argument blocks the final byte of each request until openGate is invoked
    engine.queue(request1, gate='race1')
    for x in range(10):
        engine.queue(request2, gate='race1')

    # wait until every 'race1' tagged request is ready
    # then send the final byte of each request
    # (this method is non-blocking, just like queue)
    engine.openGate('race1')

    engine.complete(timeout=60)


def handleResponse(req, interesting):
    table.add(req)
```
3. Now replace the POST request with the entire POST request, do the same for the GET request
4. Click Attack
![[Pasted image 20251209012726.png]]